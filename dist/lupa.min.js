(()=>{const LUPA_CSS="[v-cloak]{display:none}body{margin:0;overflow:hidden;padding:0}body.inverted-mode{background-color:#111;filter:invert(1) hue-rotate(180deg)}body,body.inverted-mode input,body.inverted-mode textarea{background-color:#eee}body.inverted-mode .btn{filter:invert(1) hue-rotate(180deg)}",LUPA_HTML='<div id="vueApp" class="m-1"><div v-if="isLoading" class="alert alert-secondary text-center"><table class="mx-auto"><tr><td class="align-middle">{{ loadingMessage }}</td><td><div class="spinner-border" role="status"><span class="sr-only"></span></div></td></tr></table></div><template v-if="!isLoading"><div v-for="repeat in [false, true]"><template v-if="!repeat || showBottomSearch &amp;&amp; pageRecords.length"><div style="display: flex; flex-direction: row; gap: 1em; flex-wrap: wrap; justify-content: center; align-items: center;"><div style="flex-grow: 1;"><label class="input-group m-0"><span class="input-group-text">{{ searchTermsLabel }}</span> <input type="text" class="form-control" v-model="searchTerms" v-bind:placeholder="searchTermsPlaceholder"></label></div><div v-if="pageCount &gt; 1"><nav style="user-select: none;"><ul class="pagination justify-content-center m-0"><li v-for="page in pagination" v-bind:class="\'page-item\' + (pageNumber === page.number ? \' active\' : \'\')"><a class="page-link" href="javascript:;" v-on:click="pageNumber = page.number">{{ page.number }}</a></li></ul></nav></div></div></template><div v-if="!repeat" class="my-3"><div v-if="pageCount === 0" class="alert alert-warning text-center">{{ noResultsMessage }}</div><ol v-bind:start="pageRecordsStartIndex + 1"><li v-for="record in pageRecords"><b><a v-bind:href="record.url" v-bind:target="anchorTarget">{{ record.title }}</a></b><template v-if="record.description"><br>{{ record.description }}</template><div style="color: #0006; font-family: monospace; font-size: 0.8em; font-style: italic;">{{ record.url }}</div></li></ol></div></div></template></div>';async function main(script){let settings={};var u=createCallableFrame({jsCode(){let mountedApp;const DEFAULT_PER_PAGE=25,DEFAULT_PAGINATION_LENGTH=5,DEFAULT_SEARCH_TERMS_LABEL="Search for",DEFAULT_SEARCH_TERMS_PLACEHOLDER="Enter your search terms here…",DEFAULT_SHOW_BOTTOM_SEARCH=!0,DEFAULT_ANCHOR_TARGET="_blank",DEFAULT_NO_RESULTS_MESSAGE="Sorry, no results were found.",DEFAULT_MATCH_WORD_START=!0,DEFAULT_MATCH_WORD_END=!1;function init(){const vueApp=document.querySelector("#vueApp");mountedApp=Vue.createApp({data(){return{records:[],settings:{},errorMessage:"",pageNumber:1,loadingMessage:"All searchable records are being loaded…",searchTerms:"",height:0}},watch:{searchTerms(newValue){this.pageNumber=1,setTimeout(()=>{this.searchTerms===newValue&&this.settings.searchTermsParam&&callParent("updateSearchTermsParam",newValue)},1e3)},height(newHeight){callParent("updateHeight",newHeight)},settings(newSettings){document.body.classList[newSettings?.invertedMode?"add":"remove"]("inverted-mode")}},computed:{noResultsMessage(){return this.settings.noResultsMessage??DEFAULT_NO_RESULTS_MESSAGE},anchorTarget(){return this.settings.anchorTarget??"_blank"},showBottomSearch(){return this.settings.showBottomSearch??!0},searchTermsLabel(){return this.settings.searchTermsLabel??"Search for"},searchTermsPlaceholder(){return this.settings.searchTermsPlaceholder??"Enter your search terms here…"},matchWordStart(){return this.settings.matchWordStart??!0},matchWordEnd(){return this.settings.matchWordEnd??!1},searcher(){return new Searcher(this.searchTerms,{matchWordStart:this.matchWordStart,matchWordEnd:this.matchWordEnd})},filteredRecords(){const{searcher}=this;var results;return this.records.reduce((records,r,index)=>{var matches=searcher.matchAll(`${r.url??""}
${r.title??""}
${r.description??""}
`+(r.keywords??""));return matches.length&&records.push({record:r,index:index,score:[...new Set(matches.map(m=>m[0].toUpperCase()))].reduce((score,s)=>score+s.length+1,0),score2:matches.reduce((score,m)=>score+m[0].length,0)}),records},[]).sort((a,b)=>a.score===b.score?a.score2==a.score2?a.index-b.index:b.score2-a.score2:b.score-a.score).map(({record})=>record)},isLoading(){return!!this.loadingMessage},perPage(){return this.settings.perPage??25},paginationLength(){return this.settings.paginationLength??5},pageRecords(){var startIndex=this.pageRecordsStartIndex;return this.filteredRecords.slice(startIndex,startIndex+this.perPage)},pageRecordsStartIndex(){return(this.pageNumber-1)*this.perPage},pageCount(){return Math.ceil(this.filteredRecords.length/this.perPage)},pagination(){return paginate(this.pageNumber,this.pageCount,this.paginationLength)},title(){return(this.settings.title?(document.title=this.settings.title+" – 🔍 Lupa",this.settings):document).title},description(){return this.settings.description??document.querySelector('meta[name="description"]')?.getAttribute("content")}},methods:{updateHeight(){var style=window.getComputedStyle(vueApp);this.height=parseFloat(style.height)+parseFloat(style.marginTop)+parseFloat(style.marginBottom)}},mounted(){this.updateHeight(),["orientationchange","resize"].forEach(n=>addEventListener(n,this.updateHeight))},updated(){this.updateHeight()}}).mount(vueApp)}function updateSearchTerms(searchTerms){mountedApp.searchTerms=searchTerms}function paginate(page,pageCount,paginationLength){for(var minPage=Math.max(1,Math.min(Math.floor(page),pageCount)),maxPage=minPage,pagination=[{number:minPage,isSelected:!0,isBoundary:1===minPage||maxPage===pageCount}],maxIter=2*paginationLength,iter=2;pagination.length<paginationLength&&iter++<maxIter;)iter%2==0&&1<minPage&&pagination.unshift({number:--minPage,isSelected:!1,isBoundary:1===minPage}),iter%2==1&&maxPage<pageCount&&pagination.push({number:++maxPage,isSelected:!1,isBoundary:maxPage===pageCount});return pagination}class Searcher{#terms;#matchWordStart;#matchWordEnd;#rgxFullNeg;#rgxFullPos;#rgxPartial;constructor(terms,options){this.#terms=terms??"",options=Object(options),this.#matchWordStart=!1!==options.matchWordStart,this.#matchWordEnd=!!options.matchWordEnd,this.#updateRegExps()}#updateRegExps(){this.#rgxFullNeg=null,this.#rgxFullPos=null,this.#rgxPartial=null;var nonModdedTargets=[],plusTargets=[],minusTargets=[];for(let match,rgx=/([-+])?("([^"]*)"|\S+)/g;match=rgx.exec(this.#terms.trim());){var target=(null==match[3]?match[2]:match[3]).replace(/^(?=([\p{L}\p{N}]))|(?<=([\p{L}\p{N}]))$|\\(.)|(\s?\*\s?)|(\s+)|[.+?^$\[\]\\{}()|]/gu,(m,startWithWord,endsWithWord,escapedChar,asterisk,whitespace,index,target)=>{var startWithWord,endsWithWord,whitespace;return startWithWord?this.#matchWordStart?"(?<!\\p{L}|\\p{N})":"":endsWithWord?this.#matchWordEnd?"(?!\\p{L}|\\p{N})":"":whitespace?"\\s+":asterisk?(startWithWord=match[3]?"(\\s+\\S+)*":"",endsWithWord=0==index||"*"!==asterisk.charAt(0),whitespace=index+1===target.length||"*"!==asterisk.slice(-1),endsWithWord?"(?:\\s|)\\S+"+startWithWord+(whitespace?"":"(?:\\s|$)"):"\\S*"):"\\"+(escapedChar||m)}),mod=match[1];("+"!==mod?"-"===mod?minusTargets:nonModdedTargets:plusTargets).push(target)}plusTargets.length+nonModdedTargets.length===0&&nonModdedTargets.push("^"),minusTargets.length&&(this.#rgxFullNeg=new RegExp(minusTargets.join("|"),"iu")),plusTargets.length&&(this.#rgxFullPos=new RegExp(plusTargets.map(t=>`(?=^[^]*${t})`).join(""),"iu")),this.#rgxPartial=new RegExp([...nonModdedTargets,...plusTargets].join("|"),"giu")}set matchWordStart(matchWordStart){this.#matchWordStart=matchWordStart,this.#updateRegExps()}get matchWordStart(){return this.#matchWordStart}set matchWordEnd(matchWordEnd){this.#matchWordEnd=matchWordEnd,this.#updateRegExps()}get matchWordEnd(){return this.#matchWordEnd}set terms(terms){this.#terms=terms??"",this.#updateRegExps()}get terms(){return this.#terms}test(value){return!this.#rgxFullNeg?.test(value)&&!1!==this.#rgxFullPos?.test(value)&&this.#rgxPartial.test(value)}matchAll(value){return this.#rgxFullNeg?.test(value)||!1===this.#rgxFullPos?.test(value)?[]:[...value.matchAll(this.#rgxPartial)]}}function setData({records,settings}){mountedApp.records=records,mountedApp.settings=settings,mountedApp.loadingMessage=""}},jsUrls:["https://unpkg.com/vue@3/dist/vue.global.js","https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"],cssUrls:["data:text/css,"+encodeURIComponent(LUPA_CSS),"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"],functions:{updateSearchTermsParam(searchTerms){var url=new URL(location.href),{searchTermsParam,persistSearchTermsParam}=settings,urlSearchTerms;(url.searchParams.get(searchTermsParam)??"")!==searchTerms&&(searchTerms||!1!==persistSearchTermsParam?url.searchParams.set(searchTermsParam,searchTerms):url.searchParams.delete(searchTermsParam),history.pushState({source:"lupajs",searchTerms:searchTerms},document.title,url.href))},updateHeight(newHeight){this.iframe.style.height=newHeight+"px"}},onMessage(){console.log("Got message from IFRAME:",arguments)},async onReady(){this.call("init");var scriptDataset=script.dataset,scriptDataset;let[records,settingsRecords]=await Promise.all([getRecords(scriptDataset,"records",!0),getRecords(scriptDataset,"settings",!1)]);for(const[key,value]of Object.entries(scriptDataset))key.replace(/^settings([A-Z])(.*$)/,(_,first,rest)=>{settingsRecords.push({name:first.toLowerCase()+rest,value:infer(value)})});(settings=settingsRecords.reduce((settings,record)=>(void 0!==(record=Object.entries(record).reduce((record,[key,value])=>(record[/^(?:name|value)$/i.test(key)?key.toLowerCase():key]=value,record),{})).name&&void 0!==record.value&&(settings[record.name]=record.value),settings),{})).searchTermsParam&&(scriptDataset=()=>{this.call("updateSearchTerms",new URL(location.href).searchParams.get(settings.searchTermsParam)??"")},addEventListener("popstate",scriptDataset),scriptDataset()),this.call("setData",{records:records.reduce((records,record)=>((record=Object.entries(record).reduce((record,[key,value])=>(record[/^(?:title|description|keywords|url)$/i.test(key)?key.toLowerCase():key]=value,record),{})).title&&record.url&&records.push(record),records),[]),settings:settings})},body:LUPA_HTML,style:{width:"100%",height:"0px",border:0},useBlobSrc:(u=URL.createObjectURL(new Blob),URL.revokeObjectURL(u),!u.startsWith("blob:null/"))}),u;script.parentNode.insertBefore(u.iframe,script)}async function getRecords(dataset,baseName,isRequired){var gsheetName="gsheet"+baseName.charAt(0).toUpperCase()+baseName.slice(1),gsheetInput=dataset[gsheetName],dataset=dataset[baseName];let records;if(gsheetInput?records=await readGSheetValues(gsheetInput):dataset&&("function"==typeof(records=await new(async()=>{}).constructor("return "+dataset)())||records instanceof Promise)&&(records=await records()),!Array.isArray(records)){if(!isPrimitive(records))return Object.entries(records).reduce((records,[name,value])=>records.concat([{name:name,value:value}]),[]);if(!isRequired)return[];console.log("Unexpected records:",records);var gsheetInput=baseName.replace(/[A-Z]/g,"-$&").toLowerCase(),dataset=gsheetName.replace(/[A-Z]/g,"-$&").toLowerCase();throw new Error(`Unable to get valid records from data-${gsheetInput} or data-${dataset}.`)}const firstRecord=records[0];return Array.isArray(firstRecord)?records.slice(1).map(record=>firstRecord.reduce((newRecord,key,colIndex)=>(newRecord[key]=record[colIndex],newRecord),{})):records}async function readGSheetValues(publishedURL){var parsedURL=/^(https:\/\/(?=.*\b(?:spread)sheets\b).*google\.com\/.+\/[^/]{40,}\/).+?(?:[?&]gid=([^&]+).*)?$/.exec(publishedURL),parsedURL,csvContent;if(parsedURL)return parsedURL=parsedURL[1]+"pub?output=csv&gid="+(parsedURL[2]??0),[...(await(await fetch(parsedURL)).text()).matchAll(/("(?:""|[^"]+)*"|[^,\r\n]*)(,|\r?\n|$)/g)].reduce((rows,[_,content,sep])=>{var currentRow,sep;return(sep||content)&&(currentRow=rows[rows.length-1],sep&&","!==sep&&rows.push([]),"TRUE"===content?content=!0:"FALSE"===content?content=!1:""===content?content=null:'"'===content.charAt(0)?content=content.slice(1,-1).replace(/""/g,'"'):/^-?\d+(?:\.\d+(?:E[-+]\d+)?)?$/.test(content)&&(sep=parseFloat(content))==sep&&isFinite(sep)&&(content=sep),currentRow.push(content)),rows},[[]]);throw new Error(`The given "Publish to the Web" URL is not recognized:
`+publishedURL)}function isPrimitive(input){var input;return null==input||"object"!=(input=typeof input)&&"function"!=input}function infer(input,parseUrlBools){if(input&&"string"==typeof input){if("true"===input||parseUrlBools&&/^yes$|^on$/.test(input))return!0;if("false"===input||parseUrlBools&&/^no$|^off$/.test(input))return!1;if("null"===input)return null;if("undefined"===input)return;if(/^-?(?:0|[1-9]\d*)?(?:\.\d+)?(?:e[-+]?[1-9]\d*)?$/.test(input))return+input;if(/^-?(?:0|[1-9]\d*)n$/.test(input))return BigInt(input.slice(0,-1))}return input}var createCallableFrame=function(){var IFRAME_SCRIPT_MESSAGE_CODE=parseFunction(function(){function messageParent(message){window.parent.postMessage(message,"*")}window.addEventListener("message",function(e){var func;e.data.funcName&&e.data.args&&(func=eval(e.data.funcName),"function"==typeof func)&&func.apply(e,e.data.args||[])})}).body;function createCallableFrame(options){var jsCode=options.jsCode,onMessage=options.onMessage,onReady=options.onReady,style=options.style;function getUrl(content,type){return options.useBlobSrc&&window.URL&&"function"==typeof URL.createObjectURL&&"function"==typeof Blob?URL.createObjectURL(new Blob([content],{type:type})):toDataURL(content,{type:type,charset:"utf8"})}var isReady,READY_ID=Math.random()+""+Math.random(),jsCode=getUrl(["(function(){",IFRAME_SCRIPT_MESSAGE_CODE,"var applyParent, callParent;","(function(READY_ID){",parseFunction(function(){applyParent=function(funcName,args){window.parent.postMessage({funcName:funcName,args:args,id:READY_ID},"*")},callParent=function(funcName){window.parent.postMessage({funcName:funcName,args:Array.prototype.slice.call(arguments,1),id:READY_ID},"*")};var interval=setInterval(function(){/^(complete|interactive)$/.test(document.readyState)&&(clearInterval(interval),messageParent(READY_ID))},100)}).body,"})("+JSON.stringify(READY_ID)+");","function"!=typeof jsCode?jsCode||"":parseFunction(jsCode).body,"})();"].join("\n"),"text/javascript"),IFRAME=document.createElement("iframe"),jsCode=["<!DOCTYPE html>","<html>","<head>",options.head||"",(options.cssUrls||[]).map(function(cssUrl){return'<link href="'+cssUrl+'" rel="stylesheet">'}).join("\n"),(options.jsUrls||[]).map(function(jsUrl){return'<script src="'+jsUrl+'"><\/script>'}).join("\n"),"</head>","<body>",options.body||"",'<script src="'+jsCode+'"><\/script>',"</body>","</html>"].join("\n");if(IFRAME.src=getUrl(jsCode,"text/html"),style)if("string"==typeof style)IFRAME.style.cssText=style;else for(var styleKey in style)hasOwn(style,styleKey)&&(IFRAME.style[styleKey]=style[styleKey]);addEventListener("message",function(e){var data,dataIsReadyId;e.source===IFRAME.contentWindow&&(data=e.data,dataIsReadyId=READY_ID===data,isReady&&!dataIsReadyId?options.functions&&data.id===READY_ID&&hasOwn(options.functions,data.funcName)?options.functions[data.funcName].apply(callableFrame,data.args):"function"==typeof onMessage?onMessage.call(callableFrame,e):console.warn("Message sent from callable frame but no listener was set up.",e):dataIsReadyId?(isReady=!0,"function"==typeof onReady&&onReady.call(callableFrame,e)):console.warn("Message sent from callable frame prematurely:",e))});var callableFrame={apply:function(funcName,args){IFRAME.contentWindow.postMessage({funcName:funcName,args:args},"*")},call:function(funcName){IFRAME.contentWindow.postMessage({funcName:funcName,args:Array.prototype.slice.call(arguments,1)},"*")},iframe:IFRAME};return callableFrame}function toDataURL(text,options){var base64=(options=Object(options)).base64,charset=options.charset;return("data:"+(options.type??"")+";"+(charset?"charset="+charset+";":"")+(base64?"base64;":"")).replace(/;$/,"")+","+(base64?window.btoa(unescape(encodeURIComponent(text))):encodeURIComponent(text))}var hasOwn=atob.call.bind({}.hasOwnProperty);function parseFunction(input){for(var strFunc=input+"",m;m=/\/\*[^]*?\*\/|\/\/.*/g.exec(strFunc);){var STR_BEFORE=strFunc.slice(0,m.index);if(/[\{"'`]/.test(STR_BEFORE))break;strFunc=STR_BEFORE+" "+strFunc.slice(m.index+m[0].length)}var input=/^\s*async\b/.test(strFunc),IS_GENERATOR=(input&&(strFunc=strFunc.replace("async","")),/^\s*(?:function\s*)?\*/.test(strFunc)),ARROW_MATCH=(IS_GENERATOR&&(strFunc=strFunc.replace(/(?:\bfunction\s*)?\*/,"")),/\s*=>\s*/.exec(strFunc)),INDEX_OF_FUNC_START=strFunc.search(/\)\s*\{/),INDEX_OF_FUNC_START=ARROW_MATCH&&(ARROW_MATCH.index<INDEX_OF_FUNC_START||INDEX_OF_FUNC_START<0),parameters,ARROW_MATCH,STR_BEFORE,ARROW_MATCH,parameters,ARROW_MATCH;return ARROW_MATCH=INDEX_OF_FUNC_START?(STR_BEFORE=strFunc.slice(0,ARROW_MATCH.index),ARROW_MATCH=strFunc.slice(ARROW_MATCH.index+ARROW_MATCH[0].length),parameters=(/\S+(?:\s*,\s*\S+)*/.exec(STR_BEFORE.replace(/[()]/g," "))??[])[0],/^\{/.test(ARROW_MATCH)?ARROW_MATCH.replace(/^\{|\}\s*$/g,""):"return "+ARROW_MATCH):(parameters=(/\(([^\)]*)\)/.exec(strFunc)??[])[1],(/\{([^]*)\}/.exec(strFunc)??[])[1]),{isAsync:input,isGenerator:IS_GENERATOR,isArrow:INDEX_OF_FUNC_START,parameters:parameters,body:ARROW_MATCH}}return createCallableFrame.toDataURL=toDataURL,createCallableFrame.parseFunction=parseFunction,createCallableFrame}();main(document.currentScript)})();